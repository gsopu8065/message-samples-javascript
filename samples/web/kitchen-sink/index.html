
<!doctype html>
<html class="no-js fuelux view-developer" lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Magnet</title>
    <meta name="description" content="Magnet Messenger Installer">
    <meta name="keywords" content="Mobile app development, Mobile platform, Mobile REST API, Mobile messaging">
    <link rel="stylesheet" href="https://developer.magnet.com/css/bootstrap.min.css" />
    <link href='//fonts.googleapis.com/css?family=Roboto:400,500,700,900,300,100' rel='stylesheet' type='text/css'>
</head>

<body>

<h3>Initialization</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.onReady(function() {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <h5>User</h5>
        <pre id="user-info"></pre>
        <h5>Device</h5>
        <pre id="device-info"></pre>
        <h5>App</h5>
        <pre id="app-info"></pre>
        <h5>Anonymous Token</h5>
        <pre id="auth-info"></pre>
    </div>
</div>


<h3>Registration</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>var userObj = {
    username: 'jack.doe',
    firstName: 'Jack',
    password: 'magnet'
};

Max.User.register(userObj, function() {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
<pre id="register-info"></pre>
    </div>
</div>


<h3>Login</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>var userObj = {
    username: 'jack.doe',
    password: 'magnet'
};

Max.User.login(userObj, function() {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <h5>Login</h5>
        <pre id="login-info"></pre>
        <h5>Device Register</h5>
        <pre id="deviceregister-info"></pre>
    </div>
</div>


<h3>getUsersByUserNames</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.User.getUsersByUserNames(['jane.doe@magnet.com', 'jack.doe'], function(e, users) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <pre id="getUsersByUserNames-info"></pre>
    </div>
</div>


<h3>User search List</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.User.search({
    query: 'userName:*',
    limit: 10,
    offset: 0,
    orderby: ''
}, function(e, users) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
<pre id="usersearch-info"></pre>
    </div>
</div>


<h3>Send Message</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>
Max.start();

var user = Max.getCurrentUser();

var message = new Max.Message({
    my: 'sent message'
}, user);

message.send();</pre>
    </div>
    <div class="col-sm-6">
        <div id="sendmessage-info"></div>
    </div>
</div>


<h3>Receive Message</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>
Max.start();

var listener = new Max.MessageListener('myListener', function(mmxMessage) {
    // do something
};

Max.registerListener(listener);

// Max.unregisterListener(listener);
</pre>
    </div>
    <div class="col-sm-6">
        <div id="receivemessage-info"></div>
    </div>
</div>


<h3>Create Channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.Channel.create({
    name: 'myNewPrivateChannel',
    description: 'my restrictive description',
    private: true,
    subscribe: false,
    publishPermission: 'subscribers'
}, function(e, data) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="createchannel-info"></div>
    </div>
</div>


<h3>Delete Channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.Channel.delete(function(e, data) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="deletechannel-info"></div>
    </div>
</div>


<h3>Get My Subscriptions</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.Channel.getAllSubscriptions(function(e, subscriptions) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="mysubscriptions-info"></div>
    </div>
</div>


<h3>Get Public Channels</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.Channel.findPublicChannelsByName(null, function(channels) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="getpublicchannels-info"></div>
    </div>
</div>


<h3>Get Channel Subscribers</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>mmxChannel.getAllSubscribers(function(e, subscribers) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channelsubscribers-info"></div>
    </div>
</div>


<h3>Subscribe to Channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>mmxChannel.subscribe(function(e, details) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channelsubscribe-info"></div>
    </div>
</div>


<h3>Unsubscribe from Channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>mmxChannel.unsubscribe(function(e, details) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channelunsubscribe-info"></div>
    </div>
</div>


<h3>Add Subscriber to Channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>mmxChannel.subscribe(users, function(e, details) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channeladdsubscriber-info"></div>
    </div>
</div>


<h3>Remove Subscriber from Channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>mmxChannel.unsubscribe(users, function(e, details) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channelremovesubscriber-info"></div>
    </div>
</div>


<h3>findChannelsBySubscribers</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>var user = Max.getCurrentUser();
Max.Channel.findChannelsBySubscribers([user], function(e, channels) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="findChannelsBySubscribers-info"></div>
    </div>
</div>


<h3>getChannelSummary</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>Max.Channel.getChannelSummary([channel], 10, 10, function(e, channelSummaries) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channelSummaries-info"></div>
    </div>
</div>


<h3>publish to channel</h3>
<div class="row-fluid clearfix">
    <div class="col-sm-6">
<pre>var channelMsg = new Max.Message({
    my: 'message to channel'
});
mmxChannel.publish(channelMsg, function(e, details) {
    // do something
});</pre>
    </div>
    <div class="col-sm-6">
        <div id="channelpublish-info"></div>
    </div>
</div>



<script src="../assets/jquery.js"></script>
<script src="../assets/bootstrap.min.js"></script>
<script src="../assets/magnet-sdk.js"></script>
<script>

    Max.init({
        clientId: '3ae2fca1-64d7-40b9-82c0-e43287bfa598',
        clientSecret: 'bALLfBASHcKwhkYNs8Z6Okczpe_NwsWYZyz0MeaThfE',
        baseUrl: 'http://localhost:7777/api'
    });

    $(document).ready(function() {

        Max.onReady(function() {

            $('#user-info').html(JSON.stringify(Max.getCurrentUser(), false, 4));
            $('#device-info').html(JSON.stringify(Max.Device.getCurrentDevice(), false, 4));
            $('#app-info').html(JSON.stringify(Max.Config, false, 4));
            $('#auth-info').html(JSON.stringify(Max.App.credentials, false, 4));

            var user = {
                username: 'jack.doe',
                firstName: 'Jack',
                password: 'magnet'
            };

            Max.User.register(user).always(function(res) {

                $('#register-info').html(JSON.stringify(res, false, 4));

                Max.User.login(user).success(function(loginUser, loginDevice) {

                    $('#login-info').html(JSON.stringify(loginUser, false, 4));
                    $('#deviceregister-info').html(JSON.stringify(loginDevice, false, 4));

                    Max.User.getUsersByUserNames([user.username, 'jane.doe@magnet.com']).success(function(res) {

                        $('#getUsersByUserNames-info').html(JSON.stringify(res, false, 4));

                    });

                    Max.start();

                    // listen for messages
                    var listener = new Max.MessageListener('myListener', function(mmxMessage) {
                        $('#receivemessage-info').append('<pre>'+JSON.stringify(mmxMessage, false, 4)+'</pre>');
                    });

                    Max.registerListener(listener);

                    // send message
                    var message = new Max.Message({
                        my: 'sent message'
                    }, Max.getCurrentUser());

                    message.send().success(function(res) {
                        $('#sendmessage-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');
                    });

                    // channels
                    Max.Channel.create({
                        name: 'myNewPrivateChannel',
                        description: 'my restrictive description',
                        private: true,
                        publishPermission: 'subscribers'
                    }).success(function(mmxPrivateChannel) {
                        $('#createchannel-info').append('<pre>'+JSON.stringify(mmxPrivateChannel, false, 4)+'</pre>');

                        if (mmxPrivateChannel) {

                            Max.User.search({
                                limit: 10,
                                offset: 0,
        //                        orderby: '',
                                query: 'userName:*'
                            }).success(function(users) {
                                $('#usersearch-info').html(JSON.stringify(users, false, 4));

                                mmxPrivateChannel.addSubscribers(users).success(function(res) {
                                    $('#channeladdsubscriber-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');

                                    Max.Channel.getAllSubscriptions().success(function(channels) {
                                        $('#mysubscriptions-info').append('<pre>'+JSON.stringify(channels, false, 4)+'</pre>');

                                        mmxPrivateChannel.getAllSubscribers().success(function(subscribers) {
                                            $('#channelsubscribers-info').append('<pre>'+JSON.stringify(subscribers, false, 4)+'</pre>');

                                            Max.Channel.findChannelsBySubscribers([Max.getCurrentUser()]).success(function(channels) {
                                                $('#findChannelsBySubscribers-info').append('<pre>'+JSON.stringify(channels, false, 4)+'</pre>');

                                                var channelMsg = new Max.Message({
                                                    message: 'private message to channel'
                                                });
                                                mmxPrivateChannel.publish(channelMsg).success(function(res) {
                                                    $('#channelpublish-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');

                                                    Max.Channel.getChannelSummary([mmxPrivateChannel], 10, 10).success(function(channelSummaries) {
                                                        $('#channelSummaries-info').append('<pre>'+JSON.stringify(channelSummaries, false, 4)+'</pre>');

                                                        mmxPrivateChannel.removeSubscribers(users).success(function(res) {
                                                            $('#channelremovesubscriber-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');

                                                            mmxPrivateChannel.delete().success(function(res) {
                                                                $('#deletechannel-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');
                                                            });
                                                        });
                                                    });

                                                });

                                            });
                                        });
                                    });

                                });

                            });
                        }

                        Max.Channel.create({
                            name: 'myNewPublicChannel',
                            description: 'my public description',
                            subscribe: false
                        }).always(function(res) {
                            $('#createchannel-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');

                            Max.Channel.findPublicChannelsByName().success(function(channels) {
                                $('#getpublicchannels-info').append('<pre>'+JSON.stringify(channels, false, 4)+'</pre>');

                                if (channels.length) {
                                    var mmxChannel = channels[0];
                                    mmxChannel.getAllSubscribers().success(function(subscribers) {
                                        $('#channelsubscribers-info').append('<pre>'+JSON.stringify(subscribers, false, 4)+'</pre>');

                                        var inChannel = false;
                                        for (var i=0;i<subscribers.length;++i) {
                                            if (subscribers[i].userId == Max.getCurrentUser().userIdentifier) {
                                                inChannel = true;
                                                mmxChannel.unsubscribe().success(function(res) {
                                                    $('#channelunsubscribe-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');
                                                    continueChannel(mmxChannel);
                                                });
                                                break;
                                            }
                                        }

                                        if (!inChannel) continueChannel(mmxChannel);

                                    });
                                }
                            });

                            function continueChannel(mmxChannel) {
                                mmxChannel.subscribe().success(function(res) {
                                    $('#channelsubscribe-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');
                                });
                            }

                        });


                        Max.Channel.findPublicChannelsByName().success(function(channels) {

                            var getStartedChannel;

                            if (channels.length) {
                                for (var i=0;i<channels.length;++i) {
                                    if (channels[i].name == 'GetStarted') {
                                        getStartedChannel = channels[i];
                                        subscribeAndPublish(getStartedChannel);
                                        break;
                                    }
                                }
                            }

                            if (!getStartedChannel) {
                                Max.Channel.create({
                                    name: 'GetStarted',
                                    description: 'my public description',
                                    subscribe: false
                                }).success(function(mmxPublicChannel) {
                                    subscribeAndPublish(mmxPublicChannel);
                                });
                            }
                        });

                        function subscribeAndPublish(mmxChannel) {
                            mmxChannel.subscribe().success(function(res) {
                                $('#channelsubscribe-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');

                                var channelMsg = new Max.Message({
                                    message: 'message to channel'
                                });
                                mmxChannel.publish(channelMsg).success(function(res) {
                                    $('#channelpublish-info').append('<pre>'+JSON.stringify(res, false, 4)+'</pre>');
                                });
                            });
                        }

                    });


                });

            });

        });

    });
</script>

</body>
</html>
