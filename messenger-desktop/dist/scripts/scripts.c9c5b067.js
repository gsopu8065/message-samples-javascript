angular.module("monospaced.elastic",[]).constant("msdElasticConfig",{append:""}).directive("msdElastic",["$timeout","$window","msdElasticConfig",function(a,b,c){"use strict";return{require:"ngModel",restrict:"A, C",link:function(d,e,f,g){function h(){var a=r;n=k,u=getComputedStyle(k),angular.forEach(C,function(b){a+=b+":"+u.getPropertyValue(b)+";"}),t.setAttribute("style",a)}function i(){var b,c,e,f,g;n!==k&&h(),o||(o=!0,t.value=k.value+p,t.style.overflowY=k.style.overflowY,b=""===k.style.height?"auto":parseInt(k.style.height,10),c=getComputedStyle(k).getPropertyValue("width"),"px"===c.substr(c.length-2,2)&&(f=parseInt(c,10)-x.width,t.style.width=f+"px"),e=t.scrollHeight,e>B?(e=B,g="scroll"):A>e&&(e=A),e+=x.height,k.style.overflowY=g||"hidden",b!==e&&(k.style.height=e+"px",d.$emit("elastic:resize",l)),d.$emit("taResize",l),a(function(){o=!1},1))}function j(){o=!1,i()}var k=e[0],l=e;if("TEXTAREA"===k.nodeName&&b.getComputedStyle){l.css({overflow:"hidden","overflow-y":"hidden","word-wrap":"break-word"});var m=k.value;k.value="",k.value=m;var n,o,p=f.msdElastic?f.msdElastic.replace(/\\n/g,"\n"):c.append,q=angular.element(b),r="position: absolute; top: -999px; right: auto; bottom: auto;left: 0; overflow: hidden; -webkit-box-sizing: content-box;-moz-box-sizing: content-box; box-sizing: content-box;min-height: 0 !important; height: 0 !important; padding: 0;word-wrap: break-word; border: 0;",s=angular.element('<textarea tabindex="-1" style="'+r+'"/>').data("elastic",!0),t=s[0],u=getComputedStyle(k),v=u.getPropertyValue("resize"),w="border-box"===u.getPropertyValue("box-sizing")||"border-box"===u.getPropertyValue("-moz-box-sizing")||"border-box"===u.getPropertyValue("-webkit-box-sizing"),x=w?{width:parseInt(u.getPropertyValue("border-right-width"),10)+parseInt(u.getPropertyValue("padding-right"),10)+parseInt(u.getPropertyValue("padding-left"),10)+parseInt(u.getPropertyValue("border-left-width"),10),height:parseInt(u.getPropertyValue("border-top-width"),10)+parseInt(u.getPropertyValue("padding-top"),10)+parseInt(u.getPropertyValue("padding-bottom"),10)+parseInt(u.getPropertyValue("border-bottom-width"),10)}:{width:0,height:0},y=parseInt(u.getPropertyValue("min-height"),10),z=parseInt(u.getPropertyValue("height"),10),A=Math.max(y,z)-x.height,B=parseInt(u.getPropertyValue("max-height"),10),C=["font-family","font-size","font-weight","font-style","letter-spacing","line-height","text-transform","word-spacing","text-indent"];l.data("elastic")||(B=B&&B>0?B:9e4,t.parentNode!==document.body&&angular.element(document.body).append(t),l.css({resize:"none"===v||"vertical"===v?"none":"horizontal"}).data("elastic",!0),"onpropertychange"in k&&"oninput"in k?k.oninput=k.onkeyup=i:k.oninput=i,q.bind("resize",j),d.$watch(function(){return g.$modelValue},function(a){j()}),d.$on("elastic:adjust",function(){h(),j()}),a(i),d.$on("$destroy",function(){s.remove(),q.unbind("resize",j)}))}}}}]),!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.returnExportsGlobal=b()}):"object"==typeof exports?module.exports=b():a.Autolinker=b()}(this,function(){var a=function(b){a.Util.assign(this,b),this.matchValidator=new a.MatchValidator};return a.prototype={constructor:a,urls:!0,email:!0,twitter:!0,newWindow:!0,stripPrefix:!0,className:"",htmlCharacterEntitiesRegex:/(&nbsp;|&#160;|&lt;|&#60;|&gt;|&#62;)/gi,matcherRegex:function(){var a=/(^|[^\w])@(\w{1,15})/,b=/(?:[\-;:&=\+\$,\w\.]+@)/,c=/(?:[A-Za-z][-.+A-Za-z0-9]+:(?![A-Za-z][-.+A-Za-z0-9]+:\/\/)(?!\d+\/?)(?:\/\/)?)/,d=/(?:www\.)/,e=/[A-Za-z0-9\.\-]*[A-Za-z0-9\-]/,f=/\.(?:international|construction|contractors|enterprises|photography|productions|foundation|immobilien|industries|management|properties|technology|christmas|community|directory|education|equipment|institute|marketing|solutions|vacations|bargains|boutique|builders|catering|cleaning|clothing|computer|democrat|diamonds|graphics|holdings|lighting|partners|plumbing|supplies|training|ventures|academy|careers|company|cruises|domains|exposed|flights|florist|gallery|guitars|holiday|kitchen|neustar|okinawa|recipes|rentals|reviews|shiksha|singles|support|systems|agency|berlin|camera|center|coffee|condos|dating|estate|events|expert|futbol|kaufen|luxury|maison|monash|museum|nagoya|photos|repair|report|social|supply|tattoo|tienda|travel|viajes|villas|vision|voting|voyage|actor|build|cards|cheap|codes|dance|email|glass|house|mango|ninja|parts|photo|shoes|solar|today|tokyo|tools|watch|works|aero|arpa|asia|best|bike|blue|buzz|camp|club|cool|coop|farm|fish|gift|guru|info|jobs|kiwi|kred|land|limo|link|menu|mobi|moda|name|pics|pink|post|qpon|rich|ruhr|sexy|tips|vote|voto|wang|wien|wiki|zone|bar|bid|biz|cab|cat|ceo|com|edu|gov|int|kim|mil|net|onl|org|pro|pub|red|tel|uno|wed|xxx|xyz|ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cw|cx|cy|cz|de|dj|dk|dm|do|dz|ec|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|iq|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sx|sy|sz|tc|td|tf|tg|th|tj|tk|tl|tm|tn|to|tp|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|za|zm|zw)\b/,g=/[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]?!:,.;]*[\-A-Za-z0-9+&@#\/%=~_()|'$*\[\]]/;return new RegExp(["(",a.source,")","|","(",b.source,e.source,f.source,")","|","(","(?:","(",c.source,e.source,")","|","(?:","(.?//)?",d.source,e.source,")","|","(?:","(.?//)?",e.source,f.source,")",")","(?:"+g.source+")?",")"].join(""),"gi")}(),charBeforeProtocolRelMatchRegex:/^(.)?\/\//,link:function(b){var c=this,d=this.getHtmlParser(),e=this.htmlCharacterEntitiesRegex,f=0,g=[];return d.parse(b,{processHtmlNode:function(a,b,c){"a"===b&&(c?f=Math.max(f-1,0):f++),g.push(a)},processTextNode:function(b){if(0===f)for(var d=a.Util.splitAndCapture(b,e),h=0,i=d.length;i>h;h++){var j=d[h],k=c.processTextNode(j);g.push(k)}else g.push(b)}}),g.join("")},getHtmlParser:function(){var b=this.htmlParser;return b||(b=this.htmlParser=new a.HtmlParser),b},getTagBuilder:function(){var b=this.tagBuilder;return b||(b=this.tagBuilder=new a.AnchorTagBuilder({newWindow:this.newWindow,truncate:this.truncate,className:this.className})),b},processTextNode:function(a){var b=this;return a.replace(this.matcherRegex,function(a,c,d,e,f,g,h,i,j){var k=b.processCandidateMatch(a,c,d,e,f,g,h,i,j);if(k){var l=b.createMatchReturnVal(k.match,k.matchStr);return k.prefixStr+l+k.suffixStr}return a})},processCandidateMatch:function(b,c,d,e,f,g,h,i,j){var k,l=i||j,m="",n="";if(c&&!this.twitter||f&&!this.email||g&&!this.urls||!this.matchValidator.isValidMatch(g,h,l))return null;if(this.matchHasUnbalancedClosingParen(b)&&(b=b.substr(0,b.length-1),n=")"),f)k=new a.match.Email({matchedText:b,email:f});else if(c)d&&(m=d,b=b.slice(1)),k=new a.match.Twitter({matchedText:b,twitterHandle:e});else{if(l){var o=l.match(this.charBeforeProtocolRelMatchRegex)[1]||"";o&&(m=o,b=b.slice(1))}k=new a.match.Url({matchedText:b,url:b,protocolUrlMatch:!!h,protocolRelativeMatch:!!l,stripPrefix:this.stripPrefix})}return{prefixStr:m,suffixStr:n,matchStr:b,match:k}},matchHasUnbalancedClosingParen:function(a){var b=a.charAt(a.length-1);if(")"===b){var c=a.match(/\(/g),d=a.match(/\)/g),e=c&&c.length||0,f=d&&d.length||0;if(f>e)return!0}return!1},createMatchReturnVal:function(b,c){var d;if(this.replaceFn&&(d=this.replaceFn.call(this,this,b)),"string"==typeof d)return d;if(d===!1)return c;if(d instanceof a.HtmlTag)return d.toString();var e=this.getTagBuilder(),f=e.build(b);return f.toString()}},a.link=function(b,c){var d=new a(c);return d.link(b)},a.match={},a.Util={abstractMethod:function(){throw"abstract"},assign:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},extend:function(b,c){var d=b.prototype,e=function(){};e.prototype=d;var f;f=c.hasOwnProperty("constructor")?c.constructor:function(){d.constructor.apply(this,arguments)};var g=f.prototype=new e;return g.constructor=f,g.superclass=d,delete c.constructor,a.Util.assign(g,c),f},ellipsis:function(a,b,c){return a.length>b&&(c=null==c?"..":c,a=a.substring(0,b-c.length)+c),a},indexOf:function(a,b){if(Array.prototype.indexOf)return a.indexOf(b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},splitAndCapture:function(a,b){if(!b.global)throw new Error("`splitRegex` must have the 'g' flag set");for(var c,d=[],e=0;c=b.exec(a);)d.push(a.substring(e,c.index)),d.push(c[0]),e=c.index+c[0].length;return d.push(a.substring(e)),d}},a.HtmlParser=a.Util.extend(Object,{htmlRegex:function(){var a=/[0-9a-zA-Z][0-9a-zA-Z:]*/,b=/[^\s\0"'>\/=\x01-\x1F\x7F]+/,c=/(?:".*?"|'.*?'|[^'"=<>`\s]+)/,d=b.source+"(?:\\s*=\\s*"+c.source+")?";return new RegExp(["(?:","<(!DOCTYPE)","(?:","\\s+","(?:",d,"|",c.source+")",")*",">",")","|","(?:","<(/)?","("+a.source+")","(?:","\\s+",d,")*","\\s*/?",">",")"].join(""),"gi")}(),parse:function(a,b){b=b||{};for(var c,d=b.processHtmlNode||function(){},e=b.processTextNode||function(){},f=this.htmlRegex,g=0;null!==(c=f.exec(a));){var h=c[0],i=c[1]||c[3],j=!!c[2],k=a.substring(g,c.index);k&&e(k),d(h,i.toLowerCase(),j),g=c.index+h.length}if(g<a.length){var l=a.substring(g);l&&e(l)}}}),a.HtmlTag=a.Util.extend(Object,{whitespaceRegex:/\s+/,constructor:function(b){a.Util.assign(this,b),this.innerHtml=this.innerHtml||this.innerHTML},setTagName:function(a){return this.tagName=a,this},getTagName:function(){return this.tagName||""},setAttr:function(a,b){var c=this.getAttrs();return c[a]=b,this},getAttr:function(a){return this.getAttrs()[a]},setAttrs:function(b){var c=this.getAttrs();return a.Util.assign(c,b),this},getAttrs:function(){return this.attrs||(this.attrs={})},setClass:function(a){return this.setAttr("class",a)},addClass:function(b){for(var c,d=this.getClass(),e=this.whitespaceRegex,f=a.Util.indexOf,g=d?d.split(e):[],h=b.split(e);c=h.shift();)-1===f(g,c)&&g.push(c);return this.getAttrs()["class"]=g.join(" "),this},removeClass:function(b){for(var c,d=this.getClass(),e=this.whitespaceRegex,f=a.Util.indexOf,g=d?d.split(e):[],h=b.split(e);g.length&&(c=h.shift());){var i=f(g,c);-1!==i&&g.splice(i,1)}return this.getAttrs()["class"]=g.join(" "),this},getClass:function(){return this.getAttrs()["class"]||""},hasClass:function(a){return-1!==(" "+this.getClass()+" ").indexOf(" "+a+" ")},setInnerHtml:function(a){return this.innerHtml=a,this},getInnerHtml:function(){return this.innerHtml||""},toString:function(){var a=this.getTagName(),b=this.buildAttrsStr();return b=b?" "+b:"",["<",a,b,">",this.getInnerHtml(),"</",a,">"].join("")},buildAttrsStr:function(){if(!this.attrs)return"";var a=this.getAttrs(),b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c+'="'+a[c]+'"');return b.join(" ")}}),a.MatchValidator=a.Util.extend(Object,{invalidProtocolRelMatchRegex:/^[\w]\/\//,hasFullProtocolRegex:/^[A-Za-z][-.+A-Za-z0-9]+:\/\//,uriSchemeRegex:/^[A-Za-z][-.+A-Za-z0-9]+:/,hasWordCharAfterProtocolRegex:/:[^\s]*?[A-Za-z]/,isValidMatch:function(a,b,c){return!(b&&!this.isValidUriScheme(b)||this.urlMatchDoesNotHaveProtocolOrDot(a,b)||this.urlMatchDoesNotHaveAtLeastOneWordChar(a,b)||this.isInvalidProtocolRelativeMatch(c))},isValidUriScheme:function(a){var b=a.match(this.uriSchemeRegex)[0];return"javascript:"!==b&&"vbscript:"!==b},urlMatchDoesNotHaveProtocolOrDot:function(a,b){return!(!a||b&&this.hasFullProtocolRegex.test(b)||-1!==a.indexOf("."))},urlMatchDoesNotHaveAtLeastOneWordChar:function(a,b){return a&&b?!this.hasWordCharAfterProtocolRegex.test(a):!1},isInvalidProtocolRelativeMatch:function(a){return!!a&&this.invalidProtocolRelMatchRegex.test(a)}}),a.AnchorTagBuilder=a.Util.extend(Object,{constructor:function(b){a.Util.assign(this,b)},build:function(b){var c=new a.HtmlTag({tagName:"a",attrs:this.createAttrs(b.getType(),b.getAnchorHref()),innerHtml:this.processAnchorText(b.getAnchorText())});return c},createAttrs:function(a,b){var c={href:b},d=this.createCssClass(a);return d&&(c["class"]=d),this.newWindow&&(c.target="_blank"),c},createCssClass:function(a){var b=this.className;return b?b+" "+b+"-"+a:""},processAnchorText:function(a){return a=this.doTruncate(a)},doTruncate:function(b){return a.Util.ellipsis(b,this.truncate||Number.POSITIVE_INFINITY)}}),a.match.Match=a.Util.extend(Object,{constructor:function(b){a.Util.assign(this,b)},getType:a.Util.abstractMethod,getMatchedText:function(){return this.matchedText},getAnchorHref:a.Util.abstractMethod,getAnchorText:a.Util.abstractMethod}),a.match.Email=a.Util.extend(a.match.Match,{getType:function(){return"email"},getEmail:function(){return this.email},getAnchorHref:function(){return"mailto:"+this.email},getAnchorText:function(){return this.email}}),a.match.Twitter=a.Util.extend(a.match.Match,{getType:function(){return"twitter"},getTwitterHandle:function(){return this.twitterHandle},getAnchorHref:function(){return"https://twitter.com/"+this.twitterHandle},getAnchorText:function(){return"@"+this.twitterHandle}}),a.match.Url=a.Util.extend(a.match.Match,{urlPrefixRegex:/^(https?:\/\/)?(www\.)?/i,protocolRelativeRegex:/^\/\//,protocolPrepended:!1,getType:function(){return"url"},getUrl:function(){var a=this.url;return this.protocolRelativeMatch||this.protocolUrlMatch||this.protocolPrepended||(a=this.url="http://"+a,this.protocolPrepended=!0),a},getAnchorHref:function(){var a=this.getUrl();return a.replace(/&amp;/g,"&")},getAnchorText:function(){var a=this.getUrl();return this.protocolRelativeMatch&&(a=this.stripProtocolRelativePrefix(a)),this.stripPrefix&&(a=this.stripUrlPrefix(a)),a=this.removeTrailingSlash(a)},stripUrlPrefix:function(a){return a.replace(this.urlPrefixRegex,"")},stripProtocolRelativePrefix:function(a){return a.replace(this.protocolRelativeRegex,"")},removeTrailingSlash:function(a){return"/"===a.charAt(a.length-1)&&(a=a.slice(0,-1)),a}}),a}),!function(){var a={},b=null,c=!0,d=!1;try{"undefined"!=typeof AudioContext?b=new AudioContext:"undefined"!=typeof webkitAudioContext?b=new webkitAudioContext:c=!1}catch(e){c=!1}if(!c)if("undefined"!=typeof Audio)try{new Audio}catch(e){d=!0}else d=!0;if(c){var f="undefined"==typeof b.createGain?b.createGainNode():b.createGain();f.gain.value=1,f.connect(b.destination)}var g=function(a){this._volume=1,this._muted=!1,this.usingWebAudio=c,this.ctx=b,this.noAudio=d,this._howls=[],this._codecs=a,this.iOSAutoEnable=!0};g.prototype={volume:function(a){var b=this;if(a=parseFloat(a),a>=0&&1>=a){b._volume=a,c&&(f.gain.value=a);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].volume=b._howls[d]._volume*b._volume;return b}return c?f.gain.value:b._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(a){var b=this;b._muted=a,c&&(f.gain.value=a?0:b._volume);for(var d in b._howls)if(b._howls.hasOwnProperty(d)&&b._howls[d]._webAudio===!1)for(var e=0;e<b._howls[d]._audioNode.length;e++)b._howls[d]._audioNode[e].muted=a},codecs:function(a){return this._codecs[a]},_enableiOSAudio:function(){var a=this;if(!b||!a._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){a._iOSEnabled=!1;var c=function(){var d=b.createBuffer(1,1,22050),e=b.createBufferSource();e.buffer=d,e.connect(b.destination),"undefined"==typeof e.start?e.noteOn(0):e.start(0),setTimeout(function(){(e.playbackState===e.PLAYING_STATE||e.playbackState===e.FINISHED_STATE)&&(a._iOSEnabled=!0,a.iOSAutoEnable=!1,window.removeEventListener("touchend",c,!1))},0)};return window.addEventListener("touchend",c,!1),a}}};var h=null,i={};d||(h=new Audio,i={mp3:!!h.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!h.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var j=new g(i),k=function(a){var d=this;d._autoplay=a.autoplay||!1,d._buffer=a.buffer||!1,d._duration=a.duration||0,d._format=a.format||null,d._loop=a.loop||!1,d._loaded=!1,d._sprite=a.sprite||{},d._src=a.src||"",d._pos3d=a.pos3d||[0,0,-.5],d._volume=void 0!==a.volume?a.volume:1,d._urls=a.urls||[],d._rate=a.rate||1,d._model=a.model||null,d._onload=[a.onload||function(){}],d._onloaderror=[a.onloaderror||function(){}],d._onend=[a.onend||function(){}],d._onpause=[a.onpause||function(){}],d._onplay=[a.onplay||function(){}],d._onendTimer=[],d._webAudio=c&&!d._buffer,d._audioNode=[],d._webAudio&&d._setupAudioNode(),"undefined"!=typeof b&&b&&j.iOSAutoEnable&&j._enableiOSAudio(),j._howls.push(d),d.load()};if(k.prototype={load:function(){var a=this,b=null;if(d)return void a.on("loaderror",new Error("No audio support."));for(var c=0;c<a._urls.length;c++){var e,f;if(a._format)e=a._format;else{if(f=a._urls[c],e=/^data:audio\/([^;,]+);/i.exec(f),e||(e=/\.([^.]+)$/.exec(f.split("?",1)[0])),!e)return void a.on("loaderror",new Error("Could not extract format from passed URLs, please add format parameter."));e=e[1].toLowerCase()}if(i[e]){b=a._urls[c];break}}if(!b)return void a.on("loaderror",new Error("No codec support for selected audio sources."));if(a._src=b,a._webAudio)l(a,b);else{var h=new Audio;h.addEventListener("error",function(){h.error&&4===h.error.code&&(g.noAudio=!0),a.on("loaderror",{type:h.error?h.error.code:0})},!1),a._audioNode.push(h),h.src=b,h._pos=0,h.preload="auto",h.volume=j._muted?0:a._volume*j.volume();var k=function(){a._duration=Math.ceil(10*h.duration)/10,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play(),h.removeEventListener("canplaythrough",k,!1)};h.addEventListener("canplaythrough",k,!1),h.load()}return a},urls:function(a){var b=this;return a?(b.stop(),b._urls="string"==typeof a?[a]:a,b._loaded=!1,b.load(),b):b._urls},play:function(a,c){var d=this;return"function"==typeof a&&(c=a),a&&"function"!=typeof a||(a="_default"),d._loaded?d._sprite[a]?(d._inactiveNode(function(e){e._sprite=a;var f=e._pos>0?e._pos:d._sprite[a][0]/1e3,g=0;d._webAudio?(g=d._sprite[a][1]/1e3-e._pos,e._pos>0&&(f=d._sprite[a][0]/1e3+f)):g=d._sprite[a][1]/1e3-(f-d._sprite[a][0]/1e3);var h,i=!(!d._loop&&!d._sprite[a][2]),k="string"==typeof c?c:Math.round(Date.now()*Math.random())+"";if(function(){var b={id:k,sprite:a,loop:i};h=setTimeout(function(){!d._webAudio&&i&&d.stop(b.id).play(a,b.id),d._webAudio&&!i&&(d._nodeById(b.id).paused=!0,d._nodeById(b.id)._pos=0,d._clearEndTimer(b.id)),d._webAudio||i||d.stop(b.id),d.on("end",k)},g/d._rate*1e3),d._onendTimer.push({timer:h,id:b.id})}(),d._webAudio){var l=d._sprite[a][0]/1e3,m=d._sprite[a][1]/1e3;e.id=k,e.paused=!1,o(d,[i,l,m],k),d._playStart=b.currentTime,e.gain.value=d._volume,"undefined"==typeof e.bufferSource.start?i?e.bufferSource.noteGrainOn(0,f,86400):e.bufferSource.noteGrainOn(0,f,g):i?e.bufferSource.start(0,f,86400):e.bufferSource.start(0,f,g)}else{if(4!==e.readyState&&(e.readyState||!navigator.isCocoonJS))return d._clearEndTimer(k),function(){var b=d,f=a,g=c,h=e,i=function(){b.play(f,g),h.removeEventListener("canplaythrough",i,!1)};h.addEventListener("canplaythrough",i,!1)}(),d;e.readyState=4,e.id=k,e.currentTime=f,e.muted=j._muted||e.muted,e.volume=d._volume*j.volume(),setTimeout(function(){e.play()},0)}return d.on("play"),"function"==typeof c&&c(k),d}),d):("function"==typeof c&&c(),d):(d.on("load",function(){d.play(a,c)}),d)},pause:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.pause(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=b.pos(null,a),b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else c.pause();return b.on("pause"),b},stop:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.stop(a)}),b;b._clearEndTimer(a);var c=a?b._nodeById(a):b._activeNode();if(c)if(c._pos=0,b._webAudio){if(!c.bufferSource||c.paused)return b;c.paused=!0,"undefined"==typeof c.bufferSource.stop?c.bufferSource.noteOff(0):c.bufferSource.stop(0)}else isNaN(c.duration)||(c.pause(),c.currentTime=0);return b},mute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.mute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=0:c.muted=!0),b},unmute:function(a){var b=this;if(!b._loaded)return b.on("play",function(){b.unmute(a)}),b;var c=a?b._nodeById(a):b._activeNode();return c&&(b._webAudio?c.gain.value=b._volume:c.muted=!1),b},volume:function(a,b){var c=this;if(a=parseFloat(a),a>=0&&1>=a){if(c._volume=a,!c._loaded)return c.on("play",function(){c.volume(a,b)}),c;var d=b?c._nodeById(b):c._activeNode();return d&&(c._webAudio?d.gain.value=a:d.volume=a*j.volume()),c}return c._volume},loop:function(a){var b=this;return"boolean"==typeof a?(b._loop=a,b):b._loop},sprite:function(a){var b=this;return"object"==typeof a?(b._sprite=a,b):b._sprite},pos:function(a,c){var d=this;if(!d._loaded)return d.on("load",function(){d.pos(a)}),"number"==typeof a?d:d._pos||0;a=parseFloat(a);var e=c?d._nodeById(c):d._activeNode();if(e)return a>=0?(d.pause(c),e._pos=a,d.play(e._sprite,c),d):d._webAudio?e._pos+(b.currentTime-d._playStart):e.currentTime;if(a>=0)return d;for(var f=0;f<d._audioNode.length;f++)if(d._audioNode[f].paused&&4===d._audioNode[f].readyState)return d._webAudio?d._audioNode[f]._pos:d._audioNode[f].currentTime},pos3d:function(a,b,c,d){var e=this;if(b="undefined"!=typeof b&&b?b:0,c="undefined"!=typeof c&&c?c:-.5,!e._loaded)return e.on("play",function(){e.pos3d(a,b,c,d)}),e;if(!(a>=0||0>a))return e._pos3d;if(e._webAudio){var f=d?e._nodeById(d):e._activeNode();f&&(e._pos3d=[a,b,c],f.panner.setPosition(a,b,c),f.panner.panningModel=e._model||"HRTF")}return e},fade:function(a,b,c,d,e){var f=this,g=Math.abs(a-b),h=a>b?"down":"up",i=g/.01,j=c/i;if(!f._loaded)return f.on("load",function(){f.fade(a,b,c,d,e)}),f;f.volume(a,e);for(var k=1;i>=k;k++)!function(){var a=f._volume+("up"===h?.01:-.01)*k,c=Math.round(1e3*a)/1e3,g=b;setTimeout(function(){f.volume(c,e),c===g&&d&&d()},j*k)}()},fadeIn:function(a,b,c){return this.volume(0).play().fade(0,a,b,c)},fadeOut:function(a,b,c,d){var e=this;return e.fade(e._volume,a,b,function(){c&&c(),e.pause(d),e.on("end")},d)},_nodeById:function(a){for(var b=this,c=b._audioNode[0],d=0;d<b._audioNode.length;d++)if(b._audioNode[d].id===a){c=b._audioNode[d];break}return c},_activeNode:function(){for(var a=this,b=null,c=0;c<a._audioNode.length;c++)if(!a._audioNode[c].paused){b=a._audioNode[c];break}return a._drainPool(),b},_inactiveNode:function(a){for(var b=this,c=null,d=0;d<b._audioNode.length;d++)if(b._audioNode[d].paused&&4===b._audioNode[d].readyState){a(b._audioNode[d]),c=!0;break}if(b._drainPool(),!c){var e;if(b._webAudio)e=b._setupAudioNode(),a(e);else{b.load(),e=b._audioNode[b._audioNode.length-1];var f=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",g=function(){e.removeEventListener(f,g,!1),a(e)};e.addEventListener(f,g,!1)}}},_drainPool:function(){var a,b=this,c=0;for(a=0;a<b._audioNode.length;a++)b._audioNode[a].paused&&c++;for(a=b._audioNode.length-1;a>=0&&!(5>=c);a--)b._audioNode[a].paused&&(b._webAudio&&b._audioNode[a].disconnect(0),c--,b._audioNode.splice(a,1))},_clearEndTimer:function(a){for(var b=this,c=-1,d=0;d<b._onendTimer.length;d++)if(b._onendTimer[d].id===a){c=d;break}var e=b._onendTimer[c];e&&(clearTimeout(e.timer),b._onendTimer.splice(c,1))},_setupAudioNode:function(){var a=this,c=a._audioNode,d=a._audioNode.length;return c[d]="undefined"==typeof b.createGain?b.createGainNode():b.createGain(),c[d].gain.value=a._volume,c[d].paused=!0,c[d]._pos=0,c[d].readyState=4,c[d].connect(f),c[d].panner=b.createPanner(),c[d].panner.panningModel=a._model||"equalpower",c[d].panner.setPosition(a._pos3d[0],a._pos3d[1],a._pos3d[2]),c[d].panner.connect(c[d]),c[d]},on:function(a,b){var c=this,d=c["_on"+a];if("function"==typeof b)d.push(b);else for(var e=0;e<d.length;e++)b?d[e].call(c,b):d[e].call(c);return c},off:function(a,b){var c=this,d=c["_on"+a];if(b){for(var e=0;e<d.length;e++)if(b===d[e]){d.splice(e,1);break}}else c["_on"+a]=[];return c},unload:function(){for(var b=this,c=b._audioNode,d=0;d<b._audioNode.length;d++)c[d].paused||(b.stop(c[d].id),b.on("end",c[d].id)),b._webAudio?c[d].disconnect(0):c[d].src="";for(d=0;d<b._onendTimer.length;d++)clearTimeout(b._onendTimer[d].timer);var e=j._howls.indexOf(b);null!==e&&e>=0&&j._howls.splice(e,1),delete a[b._src],b=null}},c)var l=function(b,c){if(c in a)return b._duration=a[c].duration,void n(b);if(/^data:[^;]+;base64,/.test(c)){for(var d=atob(c.split(",")[1]),e=new Uint8Array(d.length),f=0;f<d.length;++f)e[f]=d.charCodeAt(f);m(e.buffer,b,c)}else{var g=new XMLHttpRequest;g.open("GET",c,!0),g.responseType="arraybuffer",g.onload=function(){m(g.response,b,c)},g.onerror=function(){b._webAudio&&(b._buffer=!0,b._webAudio=!1,b._audioNode=[],delete b._gainNode,delete a[c],b.load())};try{g.send()}catch(h){g.onerror()}}},m=function(c,d,e){b.decodeAudioData(c,function(b){b&&(a[e]=b,n(d,b))},function(a){d.on("loaderror",a)})},n=function(a,b){a._duration=b?b.duration:a._duration,0===Object.getOwnPropertyNames(a._sprite).length&&(a._sprite={_default:[0,1e3*a._duration]}),a._loaded||(a._loaded=!0,a.on("load")),a._autoplay&&a.play()},o=function(c,d,e){var f=c._nodeById(e);f.bufferSource=b.createBufferSource(),f.bufferSource.buffer=a[c._src],f.bufferSource.connect(f.panner),f.bufferSource.loop=d[0],d[0]&&(f.bufferSource.loopStart=d[1],f.bufferSource.loopEnd=d[1]+d[2]),f.bufferSource.playbackRate.value=c._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:j,Howl:k}}),"undefined"!=typeof exports&&(exports.Howler=j,exports.Howl=k),"undefined"!=typeof window&&(window.Howler=j,window.Howl=k)}(),Max.init({clientId:"f3ef4c6b-cfcc-4f95-83eb-8815fd91d242",clientSecret:"JIKFpGH1EZSmuFGDWO8YNulR-sWSh4FLAwsknqTfXXQ",baseUrl:"http://192.168.58.1:8443/api"}),angular.module("messengerApp",["ngAnimate","ngResource","ui.router","ngSanitize","ngTouch","monospaced.elastic","angularMoment","ui.bootstrap","ui.ace"]).run(["$location","authService","$rootScope","$state",function(a,b,c,d){function e(){if(!h){h=!0;var a=["global_dev_week"];f(a,0)}}function f(a,b){a[b]&&Max.Channel.getPublicChannel(a[b]).success(function(c){c.subscribe().success(function(){f(a,++b)})}).error(function(){Max.Channel.create({name:a[b],summary:a[b],isPublic:!0,publishPermissions:"subscribers"}).success(function(){f(a,++b)})})}function g(){b.currentUser.extras&&"undefined"!=typeof b.currentUser.extras.audioNotify||(b.currentUser.extras=b.currentUser.extras||{},b.currentUser.extras.audioNotify=!1,Max.User.updateProfile(b.currentUser))}Max.on("not-authenticated",function(){b.isAuthenticated=!1,b.currentUser=null,d.go("login")}),Max.on("authenticated",function(){b.isAuthenticated=!0,b.currentUser=Max.getCurrentUser(),b.initials=b.getInitials(b.currentUser),b.userAvatar=b.currentUser.extras&&b.currentUser.extras.hasAvatar?Max.User.getAvatarUrl():null,e(),g(),d.go("app")}),Max.onReady(function(){setTimeout(function(){loading_screen.finish()},500)});var h=!1;"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),moment.locale("en",{relativeTime:{future:"in %s",past:"%s ago",s:"%d sec",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"}})}]).config(["$stateProvider","$urlRouterProvider",function(a,b){a.state("app",{url:"/chat",templateUrl:"views/main.html",controller:"MainCtrl"}).state("login",{url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"}).state("register",{url:"/register",templateUrl:"views/register.html",controller:"RegisterCtrl"}).state("app.chat",{url:"/:channelName/:userId",templateUrl:"views/chat.html",controller:"ChatCtrl"}),b.otherwise("/login")}]),angular.module("messengerApp").controller("MainCtrl",["$scope","authService","navService","$uibModal","Alerts",function(a,b,c,d,e){function f(c){b.currentUser=Max.getCurrentUser(),b.initials=b.getInitials(b.currentUser),c&&(b.userAvatar=b.currentUser.extras&&b.currentUser.extras.hasAvatar?Max.User.getAvatarUrl():null),a.safeApply(function(){a.data.firstName=b.currentUser.firstName,a.data.lastName=b.currentUser.lastName,a.data.password="",a.data.confirm="",a.authService.userAvatar=b.userAvatar,a.authService.initials=b.initials}),Audio.enabled=b.currentUser.extras&&(b.currentUser.extras.audioNotify===!0||"true"===b.currentUser.extras.audioNotify)}b.isAuthenticated&&(a.navService=c,a.authService=b,a.showDrawer=!1,a.shownDeleteAvatar=!1,a.data={extras:b.currentUser.extras||{}},Audio.enabled=b.currentUser.extras&&(b.currentUser.extras.audioNotify===!0||"true"===b.currentUser.extras.audioNotify),a.logout=function(){e.Confirm({title:"Sign Out?",description:"Are you sure you wish to sign out?"},function(){Max.User.logout(),b.isAuthenticated=!1})},a.updateProfile=function(){if(!a.data.firstName.trim().length)return alert("first name is required");if(!a.data.lastName.trim().length)return alert("last name is required");if(a.data.password.trim().length&&a.data.password!=a.data.confirm)return alert("passwords don't match");var c=angular.merge(b.currentUser,a.data);Max.User.updateProfile(c).success(function(){e.Success({title:"Profile Updated",description:"Your profile has been updated successfully."},function(){a.data.password="",a.data.confirm="",f()})})},a.createConversation=function(){d.open({animation:a.animationsEnabled,templateUrl:"InviteUsers.html",controller:"UserselectCtrl",resolve:{items:function(){return"new"}}})},a.inviteUsers=function(){d.open({animation:a.animationsEnabled,templateUrl:"InviteUsers.html",controller:"UserselectCtrl",resolve:{items:function(){return"existing"}}})},a.viewChannelDetails=function(){d.open({animation:a.animationsEnabled,templateUrl:"ChannelDetails.html",controller:"ChanneldetailsCtrl"})},a.updateAvatar=function(a){Max.User.setAvatar(a.files[0]).success(function(){try{a.value=null}catch(b){}a.value&&a.parentNode.replaceChild(a.cloneNode(!0),a),f(!0)}).error(function(a){alert(a)})},a.deleteAvatar=function(){Max.User.deleteAvatar().success(function(){f(!0)})},a.showDeleteAvatar=function(){a.shownDeleteAvatar=!0},a.hideDeleteAvatar=function(){a.shownDeleteAvatar=!1},a.toggleDrawer=function(b){a.showDrawer=b===!0?!1:!a.showDrawer},a.toggleMessageList=function(b){a.showMessageList=b===!0?!1:!a.showMessageList},a.$watch(function(){return c.currentChannel},function(b,d){"undefined"!=typeof b&&(a.navService=c)}),a.$watch(function(){return b.userAvatar},function(c,d){"undefined"!=typeof c&&(a.authService=b)}),a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},f())}]),angular.module("messengerApp").controller("LoginCtrl",["$scope",function(a){a.data={userName:"",password:""},a.doLogin=function(){var b=a.data.userName,c=a.data.password,d=a.data.rememberMe;Max.User.login(b,c,d).success(function(){}).error(function(a){alert(JSON.stringify(a))})}}]),angular.module("messengerApp").controller("RegisterCtrl",["$scope",function(a){a.data={userName:"",firstName:"",lastName:"",password:""};var b=/^[_a-z0-9]+(\.[_a-z0-9]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/;a.doRegister=function(){return a.data.firstName&&a.data.firstName.trim().length?a.data.lastName&&a.data.lastName.trim().length?a.data.userName&&a.data.userName.trim().length?b.test(a.data.userName)?a.data.password&&a.data.password.trim().length?void Max.User.register(a.data).success(function(){
var b=a.data.userName,c=a.data.password;Max.User.login(b,c).success(function(){}).error(function(a){alert(a)})}).error(function(a){alert(JSON.stringify(a))}):alert("password is required"):alert("invalid email address"):alert("email is required"):alert("last name is required"):alert("first name is required")}}]),angular.module("messengerApp").factory("authService",function(){return{isAuthenticated:!1,userAvatar:null,getInitials:function(a){var b,c="",d="";return a?(a.firstName&&a.lastName?(c=a.firstName.charAt(0),d=a.lastName.charAt(0)):a.displayName&&-1!=a.displayName.indexOf(" ")?(b=a.displayName.split(" "),c=b[0],d=b[1]):a.userName&&-1!=a.userName.indexOf(" ")?(b=a.userName.split(" "),c=b[0],d=b[1]):a.displayName?(c=a.displayName[0],d=""):(a.firstName&&(c=a.firstName.charAt(0)),a.lastName&&(d=a.lastName.charAt(0))),c.toUpperCase()+""+d.toUpperCase()):""},getDisplayName:function(a){return(a.firstName||"")+" "+(a.lastName||"")}}}).factory("navService",function(){return{currentPage:null,$currentScope:null,currentChannel:null,list:null,setUnreads:function(a){window.localStorage&&Max.getCurrentUser()&&setTimeout(function(){var b=Max.getCurrentUser();localStorage.setItem(b.userId+"_unreads",JSON.stringify(a))},0)},getUnreads:function(a){var b={};return window.localStorage&&Max.getCurrentUser()?void setTimeout(function(){var c=Max.getCurrentUser(),d=localStorage.getItem(c.userId+"_unreads");d&&(b=JSON.parse(d)),a(b)},0):a(b)},resetUnreads:function(){if(window.localStorage&&Max.getCurrentUser()){var a=Max.getCurrentUser();localStorage.removeItem(a.userId+"_unreads")}}}}).filter("nl2br",["$filter",function(a){return function(a){return a?a.replace(/\n\r?/g,"<br />"):a}}]).directive("imageonload",function(){return{restrict:"A",scope:{loadstate:"@loadstate"},link:function(a,b,c){c.imageonload||b.bind("load",function(){var a=document.getElementById("channel-messages");a.scrollTop=a.scrollHeight})}}}).directive("opendialog",function(){return{link:function(a,b,c){function d(){var b=angular.element("#userSelectModal"),c=b.controller();a.initModal(function(){c.setModel(a.data),b.modal("show")})}b.bind("click",d)}}}).directive("focusMe",["$timeout",function(a){return{scope:{trigger:"=focusMe"},link:function(b,c){b.$watch("trigger",function(d){d===!0&&a(function(){c[0].focus(),b.trigger=!1})})}}}]).directive("whenScrolled",function(){return function(a,b,c){var d=b[0];b.bind("scroll",function(){var b=d.getAttribute("direction");"up"==b&&d.scrollTop<30&&a.$apply(c.whenScrolled),"down"==b&&d.scrollTop>d.scrollHeight-d.clientHeight-30&&a.$apply(c.whenScrolled)})}}).directive("imageload",function(){return{restrict:"A",scope:{method:"&imageload",item:"=item"},link:function(a,b,c){var d=a.method();b.bind("load",function(){d(a.item,!0)}),b.bind("error",function(){d(a.item)})}}}).directive("autolinker",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){a(function(){var a=c.html();if(""===a)return!1;var b=Autolinker.link(a,{className:"autolinker",newWindow:!1});c.html(b);for(var d=c[0].getElementsByClassName("autolinker"),e=0;e<d.length;e++)angular.element(d[e]).bind("click",function(a){var b=a.target.href;return b&&window.open(b,"_blank"),a.preventDefault(),!1})},0)}}}]);var Audio={enabled:!1,receive:new Howl({urls:["sounds/whistle.mp3","sounds/whistle.ogg"]}),send:new Howl({urls:["sounds/click.mp3","sounds/click.ogg"]}),onReceive:function(){this.enabled&&this.receive.play()},onSend:function(){this.enabled&&this.send.play()}},Cookie={create:function(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toGMTString()}document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+d+"; path=/"},get:function(a){for(var b=encodeURIComponent(a)+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return decodeURIComponent(e.substring(b.length,e.length))}return null},remove:function(a){this.create(a,"",-1)}};angular.module("messengerApp").controller("ChannellistCtrl",["$scope","authService","navService","channelService","$state","Alerts",function(a,b,c,d,e,f){function g(a){var b=a.messageContent.message;return a.attachments&&a.attachments.length&&(b="a file was uploaded"),"location"==a.messageContent.type&&(b="a location was posted"),b}function h(){a.data.channelSummaries.sort(function(a,b){return a.lastPublishedTime>b.lastPublishedTime?1:b.lastPublishedTime>a.lastPublishedTime?-1:0})}if(!b.isAuthenticated)return e.go("login");d.reset(),a.data={},a.data.developerWeekChannel=null,a.data.channelSummaries=d.channelSummaries,a.data.unreads={},a.data.searchFilter="",c.list=a,c.getUnreads(function(b){a.data.unreads=b});var i=new Max.MessageListener("receivedMessageListener",function(b){Audio.onReceive();var d=!1;if(b.channel&&b.channel.name&&"askMagnet"!=b.channel.name){for(var e=0;e<a.data.channelSummaries.length;++e)a.data.channelSummaries[e].channelName==b.channel.name&&(d=!0,a.$apply(function(){a.data.channelSummaries[e].latestMsgTime=b.timestamp,a.data.channelSummaries[e].lastPublishedTime=Max.Utils.dateToISO8601(b.timestamp),a.data.channelSummaries[e].latestMessage=g(b),c.currentChannel&&b.channel.name==c.currentChannel.name&&(a.data.unreads[b.channel.name]=b.timestamp.getTime(),c.setUnreads(a.data.unreads)),h()}));d||a.refreshChannelList()}});Max.registerListener(i),a.refreshChannelList=function(){Max.Channel.getAllSubscriptions().success(function(c){if(c.length){for(var e=[],f=0;f<c.length;++f)"askMagnet"==c[f].name||c[f].isPublic||e.push(c[f]);a.data.channels=e,Max.Channel.getChannelSummary(e,10,1).success(function(c){for(var e=0;e<c.length;++e){for(var f=[],i=null,j=0;j<c[e].subscribers.length;++j)c[e].subscribers[j].userId!=Max.getCurrentUser().userId&&(f.push(b.getDisplayName(c[e].subscribers[j])),i=c[e].subscribers[j]);c[e].subscriberNames=0===f.length?b.getDisplayName(Max.getCurrentUser()):f.join(", "),c[e].ownerId=c[e].owner.userId,c[e].messages&&c[e].messages[0]&&c[e].messages[0].messageContent&&(c[e].latestMessage=g(c[e].messages[0]),c[e].latestMsgTime=c[e].messages[0].timestamp),i||(i=Max.getCurrentUser()),c[e].chatPhoto={url:i.getAvatarUrl(),initials:b.getInitials(i)},d.channelSummaries.push(c[e])}a.$apply(function(){a.data.channelSummaries=c,h()})})}})},a.$watch(function(){return d.channelSummaries},function(b,c){"undefined"!=typeof b&&(a.data.channelSummaries=d.channelSummaries)}),a.$watch(function(){return c.currentChannel},function(b,d){if("undefined"!=typeof b)for(var e=0;e<a.data.channelSummaries.length;++e)c.currentChannel&&c.currentChannel.name&&a.data.channelSummaries[e].channel.name==c.currentChannel.name&&(a.data.channelSummaries[e].isUnread=!1)}),a.leaveConversation=function(b){var d=b.channel;f.Confirm({title:"Leave This Chat?",description:"Are you sure you wish to leave this chat room?"},function(){d.unsubscribe().success(function(){for(var b=0;b<a.data.channelSummaries.length;++b)if(a.data.channelSummaries[b].channelName==d.name){a.$apply(function(){a.data.channelSummaries.splice(b,1)}),c.currentChannel=null;break}})})},a.onLoadAttempt=function(b,c){a.$apply(function(){b.showPhoto=c})},a.updateSubscribers=function(c,d){for(var e=[],f=0;f<a.data.channelSummaries.length;++f)if(c.name==a.data.channelSummaries[f].channelName){a.data.channelSummaries[f].subscribers=a.data.channelSummaries[f].subscribers.concat(d);for(var g=0;g<a.data.channelSummaries[f].subscribers.length;++g)a.data.channelSummaries[f].subscribers[g].userId!=Max.getCurrentUser().userId&&e.push(b.getDisplayName(a.data.channelSummaries[f].subscribers[g]));a.$apply(function(){a.data.channelSummaries[f].subscriberNames=e.join(", ")});break}},a.clearUnread=function(b){b.latestMsgTime&&(a.data.unreads[b.channelName]=b.latestMsgTime.getTime(),c.setUnreads(a.data.unreads))},a.userFilter=function(b){return-1!=b.subscriberNames.toLowerCase().indexOf(a.data.searchFilter.toLowerCase())},a.refreshChannelList()}]),angular.module("messengerApp").service("channelService",function(){return{channelSummaries:[],reset:function(){this.channelSummaries=[]}}}),angular.module("messengerApp").controller("ChatCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","$interval","navService","authService","$uibModal","Alerts",function(a,b,c,d,e,f,g,h,i,j){function k(b){u=null===u?0:u+30,x.getMessages(null,v,30,u,!0).success(function(c,d){if(!c.length)return void a.safeApply(function(){a.data.messageEndReached=!0});var e=[];for(z=0;z<c.length;++z)e.push(c[z].sender.userId),"code"==c[z].messageContent.format&&c[z].messageContent.message.replace(/</g,"&lt;").replace(/>/g,"&gt;"),u>0&&(c[z].scrolled=!0);Max.User.getUsersByUserIds(e).success(function(d){for(z=0;z<d.length;++z)d[z].initials=h.getInitials(d[z]),d[z].displayName=h.getDisplayName(d[z]),a.data.subscribers[d[z].userId]=d[z];for(z=0;z<c.length;++z)p(c[z]);a.safeApply(function(){a.data.messages=c.concat(a.data.messages),setTimeout(function(){(b||angular.noop)(c.length)},20)})})})}function l(){a.safeApply(function(){a.data.isLoading=!0,n()})}function m(){a.$apply(function(){a.data.isLoading=!1})}function n(){setTimeout(function(){var a=document.getElementById("channel-messages");a&&(a.scrollTop=a.scrollHeight)},5)}function o(a){try{a.value=null}catch(b){}a.value&&a.parentNode.replaceChild(a.cloneNode(!0),a)}function p(b){!b.sender.displayName&&a.data.subscribers[b.sender.userId]&&(b.sender.displayName=h.getDisplayName(a.data.subscribers[b.sender.userId])),b.sender.initials=h.getInitials(b.sender)}var q,r,s,t,u,v,w,x,y;if(a.data={channelTitle:null,messages:[],currentUser:null,message:"",subscribers:{},isLoading:!1,messageEndReached:!1},a.authService=h,!h.isAuthenticated)return c.go("login");g.currentChannel={name:d.channelName,userId:"*"==d.userId?null:d.userId},a.data.channelTitle="*"==d.userId?d.channelName:"Private Chat",a.data.currentUser=Max.getCurrentUser();var z;a.data.messages=[],a.data.message="",a.data.subscribers={},a.data.isOwner=a.data.currentUser.userId===d.userId,u=null,v=new Date,a.data.messageEndReached=!1,w=!1,x=new Max.Channel({name:d.channelName,userId:"*"==d.userId?null:d.userId}),k(function(){n()}),y=new Max.MessageListener("channelMessageListener",function(b){b.channel&&b.channel.name==x.name&&(Audio.onReceive(),"code"==b.messageContent.format&&b.messageContent.message.replace(/</g,"&lt;").replace(/>/g,"&gt;"),a.data.subscribers[b.sender.userId]?(p(b),a.safeApply(function(){a.data.messages.push(b)})):Max.User.search({userId:b.sender.userId},1,0).success(function(c){if(c.length){var d=c[0];p(b),a.safeApply(function(){d.initials=h.getInitials(d),d.displayName=h.getDisplayName(d),a.data.subscribers[d.userId]=d,a.data.messages.push(b)})}}),n())}),Max.registerListener(y),e(function(){q=document.body.querySelector("#userMessagesScroll .bar-footer"),r=document.body.querySelector("#userMessagesScroll .scroll-content"),s=angular.element(q.querySelector("textarea"))},0),a.sendMessage=function(){if(!a.data.message.length)return a.data.message="";var b=new Max.Message({message:a.data.message,type:"text"});a.safeApply(function(){a.data.message=""}),x.publish(b).success(function(){Audio.onSend()}).error(function(a){alert(a)})},a.onFileSelect=function(a,b){l();var c=new Max.Message({type:b});x.publish(c,a.files).success(function(){Audio.onSend()}).error(function(a){alert(a)}).always(function(){o(a),m()})},a.onLocationSend=function(){var a="unable to obtain your location.";navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){l();var b=new Max.Message({type:"location",latitude:a.coords.latitude.toString(),longitude:a.coords.longitude.toString()});x.publish(b).success(function(){Audio.onSend()}).error(function(a){alert(a)}).always(function(){m()})},function(){alert(a)}):alert(a)},a.onCreateCodeSnippet=function(){var b=i.open({animation:a.animationsEnabled,templateUrl:"SendCodeSnippet.html",controller:"CreatesnippetCtrl"});b.result.then(function(b){a.sendCodeSnippet(b)})},a.sendCodeSnippet=function(a){l();var b=new Max.Message({type:"text",format:"code",lang:a.lang,message:a.snippet});x.publish(b).success(function(){Audio.onSend()}).error(function(a){alert(a)}).always(function(){m()})},a.onMessageScroll=function(){a.data.messageEndReached||w||(w=!0,t=document.getElementById("channel-messages").scrollHeight,k(function(a){var b=document.getElementById("channel-messages"),c=document.getElementById("channel-messages").scrollHeight;b.scrollTop=c-t,w=!1}))},a.gotoConversationDetails=function(){c.go("app.details",{channelName:x.name,userId:x.userId})},a.deleteMessage=function(b,c){j.Confirm({title:"Delete This Message?",description:"Are you sure you wish to delete this message?"},function(){x.deleteMessage(b.messageID).success(function(b){a.safeApply(function(){a.data.messages.splice(c,1)})}).error(function(a){console.log(a)})})},a.aceLoaded=function(a){a.setReadOnly(!0),a.setOptions({readOnly:!0,highlightActiveLine:!1,highlightGutterLine:!1}),a.renderer.$cursorLayer.element.style.opacity=0,a.container.style.pointerEvents="none",a.renderer.setStyle("disabled",!0),a.blur()},a.showFullSnippet=function(b){i.open({animation:a.animationsEnabled,templateUrl:"ShowCodeSnippet.html",controller:"ShowsnippetCtrl",resolve:{items:function(){return b}}})},a.$on("taResize",function(a,b){if(b){var c=b[0].offsetHeight;if(q){var d=c+10;d=d>44?d:44,q.style.height=d+"px",r.style.bottom=d+"px"}}}),a.$watch(function(){return h.userAvatar},function(b,c){"undefined"!=typeof b&&(a.authService=h)})}]),angular.module("messengerApp").factory("Alerts",["$uibModal",function(a){return{General:function(b,c){a.open({templateUrl:"AlertGeneralModal.html",controller:"GeneralAlertCtrl",resolve:{params:function(){return b}}}).result.then(function(){typeof c==typeof Function&&c()},function(){typeof c==typeof Function&&c()})},Confirm:function(b,c,d,e){a.open({templateUrl:"AlertConfirmModal.html",controller:"GeneralAlertCtrl",resolve:{params:function(){return b}}}).result.then(function(a){return"custom"==a&&typeof e==typeof Function?e():void(typeof c==typeof Function&&c())},function(){typeof d==typeof Function&&d()})},Success:function(b,c){a.open({templateUrl:"AlertSuccessModal.html",controller:"GeneralAlertCtrl",resolve:{params:function(){return b}}}).result.then(function(){typeof c==typeof Function&&c()},function(){typeof c==typeof Function&&c()})},Error:function(b,c){a.open({templateUrl:"AlertErrorModal.html",controller:"GeneralAlertCtrl",resolve:{params:function(){return b}}}).result.then(function(){typeof c==typeof Function&&c()},function(){})}}}]).controller("GeneralAlertCtrl",["$scope","$uibModalInstance","params",function(a,b,c){a.data=c,a.ok=function(c,d){b.close(c||a,d)},a.action=function(a){c&&typeof c[a]==typeof Function&&c[a].apply(null,arguments)},a.close=function(){b.dismiss("cancel")},a.cancel=function(){b.dismiss("cancel")},a.validators=c?c.validators:{}}]),angular.module("messengerApp").controller("UserselectCtrl",["$scope","authService","navService","$state","$uibModalInstance","items",function(a,b,c,d,e,f){function g(a,b,f){a.addSubscribers(b).success(function(){f?c.list.refreshChannelList():c.currentChannel&&c.list.updateSubscribers(c.currentChannel,b),d.go("app.chat",{channelName:a.name,userId:a.userId}),e.close(b)})}function h(a){for(var b=[],c=0;c<a.length;++c)b.push(a[c].userId);return b}if(!b.isAuthenticated)return d.go("login");var i,j,k=!1,l=0,m=null;a.authService=b,a.data={users:[],selectCount:0,channelState:f,search:"",searchError:null,selectedUsers:{},fetchEndReached:!1},"existing"===f&&(i=new Max.Channel({name:c.currentChannel.name,userId:c.currentChannel.userId})),a.searchUsers=function(b,c){b||(a.data.users=[],a.data.fetchEndReached=!1,l=0,b=0),clearTimeout(m),m=setTimeout(function(){if(a.data.search.trim().length){var d=a.data.search.split(" ");j="",d[1]?j+="firstName:*"+d[0]+"*%20AND%20lastName:*"+d[1]+"*":d[0]&&(j+="firstName:*"+d[0]+"*%20OR%20lastName:*"+d[0]+"*")}else j={firstName:"*"};Max.User.search(j,10,b).success(function(b){return b.length?void(i?i.getAllSubscribers(100).success(function(d){var e=h(d);a.$apply(function(){for(var d=0;d<b.length;++d)-1==e.indexOf(b[d].userId)&&a.data.users.push(b[d]);(c||angular.noop)()})}):a.$apply(function(){a.data.users=a.data.users.concat(b),(c||angular.noop)()})):void a.safeApply(function(){a.data.fetchEndReached=!0,k=!1})})},0===b?500:0)},a.addUser=function(b){a.data.selectCount+=1,a.data.selectedUsers[b.userId]=b},a.removeUser=function(b){a.data.selectCount-=1,delete a.data.selectedUsers[b.userId]},a.startConversation=function(){var c=[];for(var f in a.data.selectedUsers)c.push(a.data.selectedUsers[f]);if(!c.length)return alert("no users selected");if(i)return g(i,c);var h=angular.copy(c);h.push(Max.getCurrentUser()),Max.Channel.findChannelsBySubscribers(h).success(function(a){for(var f,h=0;h<a.length;++h)a[h].isPublic||(f=a[h]);if(f)d.go("app.chat",{channelName:f.name,userId:f.userId}),e.close(c);else{var i=(new Date).getTime();Max.Channel.create({name:i,summary:b.currentUser.userName,isPublic:!1,publishPermissions:"subscribers"}).success(function(a){g(a,c,!0)})}})},a.onUserScroll=function(){if(!a.data.fetchEndReached&&a.data.users.length&&!k){k=!0;var b=document.getElementById("user-selection-list").scrollHeight;l+=10,a.searchUsers(l,function(){var a=document.getElementById("user-selection-list"),c=document.getElementById("user-selection-list").scrollHeight;a.scrollTop=c-b,k=!1})}},a.cancel=function(){e.dismiss("cancel")},a.safeApply=function(a){var b=this.$root.$$phase;"$apply"==b||"$digest"==b?a&&"function"==typeof a&&a():this.$apply(a)},a.searchUsers()}]),angular.module("messengerApp").controller("ChanneldetailsCtrl",["$scope","authService","navService","$state","$uibModalInstance",function(a,b,c,d,e){if(!b.isAuthenticated)return d.go("login");var f,g=!1,h=0;a.authService=b,a.data={users:[],fetchEndReached:!1},a.data.currentUser=Max.getCurrentUser(),f=new Max.Channel({name:c.currentChannel.name,userId:c.currentChannel.userId}),a.fetchUsers=function(b,c){b||(a.data.fetchEndReached=!1,h=0,b=0),f.getAllSubscribers(10,b).success(function(b){return b.length?void a.$apply(function(){a.data.users=a.data.users.concat(b),a.data.isOwner=f.isOwner(),(c||angular.noop)()}):void a.safeApply(function(){a.data.fetchEndReached=!0})})},a.onUserScroll=function(){if(!a.data.fetchEndReached&&!g){g=!0;var b=document.getElementById("member-list").scrollHeight;h+=10,a.fetchUsers(h,function(){var a=document.getElementById("member-list"),c=document.getElementById("member-list").scrollHeight;a.scrollTop=c-b,g=!1})}},a.cancel=function(){e.dismiss("cancel")},a.fetchUsers()}]),angular.module("messengerApp").controller("ForumcarouselCtrl",["$scope","$state",function(a,b){a.slideInterval=1e4,a.noWrapSlides=!1,a.active=0;var c=a.slides=[],d=0;c.push({image:"images/bg_msg_devweek.png",text:"Developer Week",channel:"global_dev_week",id:d++}),a.goToConversation=function(a){b.go("app.chat",{channelName:a,userId:"*"})}}]),angular.module("messengerApp").controller("CreatesnippetCtrl",["$scope","$uibModalInstance",function(a,b){a.data={snippet:"",lang:"plain_text"},a.createSnippet=function(){b.close(a.data)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("messengerApp").controller("ShowsnippetCtrl",["$scope","items","$uibModalInstance",function(a,b,c){a.data=b,a.cancel=function(){c.dismiss("cancel")}}]);